{"version":3,"sources":["etgenderpaygap.js"],"names":["$","$form","html","$button","prop","on","handleCalculateButton","append","$result","hide","$companyInput","find","$bonusInput","$salaryInput","$hints","hintIndex","selectedCompany","hints","hintCount","debounce","console","log","paygap_hours","salary","parseFloat","val","loss","bonus","paygap_bonus","Math","validateForm","selectCompany","name","highlightCompany","removeClass","eq","addClass","handleKeyUp","e","keyCode","length","window","clearTimeout","replace","setTimeout","getMatches","getJSON","company","done","json","matches","count","createHints","fail","jqxhr","textStatus","error","err","$ul","forEach","hint","i","$li","text","empty","fadeIn","jQuery"],"mappings":"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","file":"etgenderpaygap.js","sourcesContent":["(($)=>$(()=>{\n  const $form = $('.etgpg');\n\n\n  $form.html(`\n    <div class=\"etgpg__field\"><label>Salary\n    <input name=\"salary\" type=\"number\" /></label></div>\n\n    <div class=\"etgpg__field\"><label>Bonus (optional)\n    <input name=\"bonus\" type=\"number\" /></label></div>\n\n    <div class=\"etgpg__field\"><label>Company\n    <input name=\"company\" /></label>\n    <div class=\"etgpg__hints\"></div></div>\n\n  `);\n  const $button = $('<button>Calculate</button>').prop('disabled', true).on('click', handleCalculateButton);\n  $form.append($button);\n\n  const $result = $('<div class=\"etgpg__result\"/>').hide();\n  $form.append($result);\n\n  const $companyInput = $form.find('input[name=\"company\"]');\n  const $bonusInput = $form.find('input[name=\"bonus\"]');\n  const $salaryInput = $form.find('input[name=\"salary\"]');\n  const $hints = $form.find('.etgpg__hints');\n  var hintIndex = -1;\n  var selectedCompany = false;\n  var hints = [];\n  var hintCount = 0;\n  var debounce = false;\n\n  function handleCalculateButton() {\n    console.log(\"OK here you go \", selectedCompany);\n    if (selectedCompany.paygap_hours > 0) {\n      const salary = parseFloat($salaryInput.val()) ;\n      var loss = salary * selectedCompany.paygap_hours;\n      const bonus = parseFloat($bonusInput.val()) ;\n      if (selectedCompany.paygap_bonus > 0 && bonus > 0) {\n        loss += bonus * selectedCompany.paygap_bonus;\n      }\n      $result.html('Loss Â£' + Math.loss);\n    }\n    else {\n      $result.html('We could not identify a pay gap at this company. National average is 18.2%');\n    }\n  }\n  function validateForm() {\n    if (selectedCompany) {\n      $button.prop('disabled', false);\n    }\n  }\n  function selectCompany() {\n    $companyInput.val(hints[hintIndex].name);\n    selectedCompany = hints[hintIndex];\n    $hints.hide();\n    validateForm();\n  }\n  function highlightCompany() {\n    $hints.find('li.highlighted').removeClass('highlighted');\n    if (hintIndex>-1) {\n      $hints.find('li').eq(hintIndex).addClass('highlighted');\n    }\n  }\n  function handleKeyUp(e) {\n    if (e.keyCode == 13) {\n      if (hintIndex < 0) {\n        // Cannot submit.\n\n      }\n      else {\n        selectCompany();\n        // Select hint.\n        // @todo trigger save.\n        // @todo update lifetime loss.\n      }\n    }\n    else if (e.keyCode == 38) {\n      hintIndex--;\n      if (hintIndex <0) {\n        hintIndex = hints.length - 1;\n      }\n      highlightCompany();\n    }\n    else if (e.keyCode == 40) {\n      hintIndex++;\n      if (hintIndex >= hints.length) {\n        hintIndex--;\n      }\n      highlightCompany();\n    }\n    else {\n      if (debounce) {\n        window.clearTimeout(debounce);\n        debounce = false;\n      }\n      if ($companyInput.val().replace(/^\\s*(.*?)\\s*$/, '$1')) {\n        debounce = window.setTimeout(getMatches, 150);\n      }\n      else {\n        hints = [];\n        hintIndex = -1;\n        highlightCompany();\n      }\n    }\n  }\n  function getMatches() {\n    $.getJSON('/etgenderpaygap/matches', { company: $companyInput.val() })\n    .done(json => {\n      console.log(\"matches\", json);\n      hints = json.matches;\n      hintCount = json.count;\n      createHints();\n    })\n    .fail((jqxhr, textStatus, error) => {\n      var err = textStatus + \", \" + error;\n      console.log( \"Request Failed: \" + err );\n    });\n  }\n  function createHints() {\n    if (hintCount > 0) {\n      const $ul = $('<ul/>');\n\n      hints.forEach((hint, i) => {\n        const $li = $('<li/>')\n          .text(hint.name);\n        $li.on('click', e => { hintIndex = i; highlightCompany(); selectCompany(); });\n        $ul.append($li);\n      });\n      hintIndex = 0;\n      $hints.empty().append($ul);\n      $hints.fadeIn('fast');\n    }\n    else {\n      hintIndex = -1;\n      $hints.empty();\n    }\n    highlightCompany();\n  }\n\n  $companyInput.on('keyup', handleKeyUp);\n\n\n}))(jQuery);\n"]}