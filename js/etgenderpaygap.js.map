{"version":3,"sources":["etgenderpaygap.js"],"names":["$","$form","html","$button","prop","on","handleCalculateButton","append","$result","hide","$companyInput","find","$bonusInput","validateForm","$salaryInput","$hints","hintIndex","selectedCompany","hints","hintCount","debounce","isSaving","text","ajax","url","dataType","method","type","data","company","id","salary","val","bonus","then","console","log","r","show","fail","jqxhr","textStatus","error","alert","valid","parseInt","selectCompany","name","highlightCompany","removeClass","eq","addClass","handleKeyUp","e","keyCode","length","window","clearTimeout","replace","setTimeout","getMatches","getJSON","done","json","matches","count","createHints","err","$ul","forEach","hint","i","$li","empty","fadeIn","fadeOut","jQuery"],"mappings":"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","file":"etgenderpaygap.js","sourcesContent":["(($)=>$(()=>{\n  const $form = $('.etgpg');\n\n\n  $form.html(`\n    <div class=\"etgpg__field\">\n      <label for=\"etgpg__salary\">Salary</label>\n      <div class=\"etgpg__input\"><input id=\"etgpg__salary\" name=\"salary\" type=\"number\" /></div>\n    </div>\n\n    <div class=\"etgpg__field\">\n      <label for=\"etgpg__bonus\">Bonus (optional)</label>\n      <div class=\"etgpg__input\"><input id=\"etgpg__bonus\" name=\"bonus\" type=\"number\" /></div>\n    </div>\n\n    <div class=\"etgpg__field etgpg__field--company\">\n      <label for=\"etgpg__company\">Company</label>\n      <div class=\"etgpg__input\">\n        <input id=\"etgpg__company\" name=\"company\" />\n        <div class=\"etgpg__hints\"></div>\n      </div>\n    </div>\n\n  `);\n  const $button = $('<button>Calculate</button>').prop('disabled', true).on('click', handleCalculateButton);\n  $form.append($button);\n\n  const $result = $('<div class=\"etgpg__result\"/>').hide();\n  $form.append($result);\n\n  const $companyInput = $form.find('input[name=\"company\"]');\n  const $bonusInput = $form.find('input[name=\"bonus\"]').on('input', validateForm);\n  const $salaryInput = $form.find('input[name=\"salary\"]').on('input', validateForm);\n  const $hints = $form.find('.etgpg__hints');\n  var hintIndex = -1;\n  var selectedCompany = false;\n  var hints = [];\n  var hintCount = 0;\n  var debounce = false;\n  var isSaving = false;\n\n  function handleCalculateButton() {\n    $button.prop('disabled', true).text('Just a mo...');\n\n    // Log at the server.\n    $.ajax({\n      url: '/etgenderpaygap/submit',\n      dataType: 'json',\n      method: 'POST', // In case they upgrade to jQuery 1.9\n      type: 'POST', // for jQuery 1.8\n      data: {\n        company: selectedCompany.id,\n        salary: $salaryInput.val(),\n        bonus: $bonusInput.val(),\n      },\n    })\n    .then(r => {\n      console.log(r);\n      $result.show();\n    })\n    .fail((jqxhr, textStatus, error) => {\n      $button.prop('disabled', false);\n      alert(\"Sorry, something went wrong, please try again.\");\n    });\n\n  }\n  function validateForm() {\n    valid = (!!selectedCompany) && parseInt($salaryInput.val()) > 0;\n    $button.prop('disabled', !valid);\n  }\n  function selectCompany() {\n    console.log(\"selectCompany\", hintIndex, hints[hintIndex]);\n    $companyInput.val(hints[hintIndex].name);\n    selectedCompany = hints[hintIndex];\n    $hints.hide();\n    validateForm();\n  }\n  function highlightCompany() {\n    $hints.find('li.highlighted').removeClass('highlighted');\n    if (hintIndex>-1) {\n      $hints.find('li').eq(hintIndex).addClass('highlighted');\n    }\n  }\n  function handleKeyUp(e) {\n    if (e.keyCode == 13) {\n      if (hintIndex < 0) {\n        // Cannot submit.\n\n      }\n      else {\n        selectCompany();\n        // Select hint.\n        // @todo trigger save.\n        // @todo update lifetime loss.\n      }\n    }\n    else if (e.keyCode == 38) {\n      hintIndex--;\n      if (hintIndex <0) {\n        hintIndex = hints.length - 1;\n      }\n      highlightCompany();\n    }\n    else if (e.keyCode == 40) {\n      hintIndex++;\n      if (hintIndex >= hints.length) {\n        hintIndex--;\n      }\n      highlightCompany();\n    }\n    else {\n      if (debounce) {\n        window.clearTimeout(debounce);\n        debounce = false;\n      }\n      if ($companyInput.val().replace(/^\\s*(.*?)\\s*$/, '$1')) {\n        debounce = window.setTimeout(getMatches, 150);\n      }\n      else {\n        hints = [];\n        hintIndex = -1;\n        highlightCompany();\n      }\n    }\n  }\n  function getMatches() {\n    $.getJSON('/etgenderpaygap/matches', { company: $companyInput.val() })\n    .done(json => {\n      console.log(\"matches\", json);\n      hints = json.matches;\n      hintCount = json.count;\n      createHints();\n    })\n    .fail((jqxhr, textStatus, error) => {\n      var err = textStatus + \", \" + error;\n      console.log( \"Request Failed: \" + err );\n    });\n  }\n  function createHints() {\n    if (hintCount > 0) {\n      const $ul = $('<ul/>');\n\n      hints.forEach((hint, i) => {\n        const $li = $('<li/>')\n          .text(hint.name);\n        $li.on('click', e => { console.log(\"hintIndex set to \", i); hintIndex = i; highlightCompany(); selectCompany(); });\n        $ul.append($li);\n      });\n      hintIndex = 0;\n      $hints.empty().append($ul);\n      $hints.fadeIn('fast');\n    }\n    else {\n      hintIndex = -1;\n      $hints.empty();\n    }\n    highlightCompany();\n  }\n\n  $companyInput\n    .on('keyup', handleKeyUp)\n    .on('blur', e => $hints.fadeOut('fast'));\n\n\n}))(jQuery);\n"]}